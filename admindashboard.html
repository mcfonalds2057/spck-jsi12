<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://kit.fontawesome.com/f2a0c15a9d.js" crossorigin="anonymous"></script>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <img
          width="150px"
          height="70px"
          src="la grasa brand V2.png"
          alt="lapnest logo"
        />
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Trang Chủ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="aboutus.html">Về Chúng Tôi</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="login.html">Đăng Xuất</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admindashboard.html">Trang chủ Admin</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="support.html">Hỗ Trợ</a>
            </li>
            <li class="nav-item"><a class="nav-link active" href="shoppingcart.html"><i class="fa-solid fa-cart-shopping"></i></a></li>
          </ul>
        </div>
      </div>
    </nav>

    <p></p>

    <h2>Trang chủ Admin</h2>
    <p></p>
    <button
      class="btn btn-primary btn-custom"
      data-bs-toggle="modal"
      data-bs-target="#createProductModal"
      style="background-color: rgb(15, 217, 15)"
    >
      Tạo sản phẩm
    </button>
    <div
      class="modal fade"
      id="createProductModal"
      tabindex="-1"
      aria-labelledby="createProductModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createProductModalLabel">
              Tạo sản phẩm
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <br />

          <div class="modal-body">
            <div id="createProductForm">
              <div class="mb-3">
                <label for="name" class="form-label">Tên sản phẩm</label>
                <input
                  type="text"
                  class="form-control"
                  id="productName"
                  placeholder="Nhập tên sản phẩm"
                />
              </div>
              <div class="mb-3">
                <label for="detail" class="form-label">Chi tiết sản phẩm</label>
                <input
                  type="text"
                  class="form-control"
                  id="detail"
                  placeholder="Nhập thông tin chi tiết"
                />
              </div>
              <div class="mb-3">
                <label for="price" class="form-label">Giá tiền</label>
                <input
                  type="text"
                  class="form-control"
                  id="price"
                  placeholder="Nhập giá tiền"
                />
              </div>
              <div class="mb-3">
                <label for="imageUrl" class="form-label">Ảnh URL</label>
                <input
                  type="url"
                  class="form-control"
                  id="productUrl"
                  placeholder="Nhập URL ảnh sản phẩm"
                />
              </div>
              <button type="submit" id="createProduct" class="btn btn-primary">
                Tạo
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button
      class="btn btn-primary btn-custom"
      data-bs-toggle="modal"
      data-bs-target="#createProductModal2"
      style="background-color: rgb(15, 217, 15)"
    >
      Tạo người dùng
    </button>

    <div
      class="modal fade"
      id="createProductModal2"
      tabindex="-1"
      aria-labelledby="createProductModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createProductModalLabel">
              Tạo người dùng
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
              <div class="mb-3">
                <label for="detail" class="form-label">Tên người dùng</label>
                <input
                  type="text"
                  class="form-control"
                  id="detail"
                  placeholder="Nhập tên người dùng"
                />
              </div>
              <div class="mb-3">
                <label for="price" class="form-label">Mật khẩu</label>
                <input
                  type="password"
                  class="form-control"
                  id="price"
                  placeholder="Nhập mật khẩu"
                />
              </div>
              <div class="mb-3">
                <label for="price" class="form-label">Ảnh đại diện (URL)</label>
                <input
                  type="url"
                  class="form-control"
                  id="avatarUrl"
                  placeholder="Nhập URL cho ảnh đại diện"
                />
              </div>
              <button type="submit" id="createUser" class="btn btn-primary">
                Tạo
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <p></p>

    <table class="table">
      <thead>
        <tr>
          <th scope="col">Số thứ tự</th>
          <th scope="col">Tên sản phẩm</th>
          <th scope="col">Chi tiết sản phẩm</th>
          <th scope="col">Giá tiền</th>
          <th scope="col">Ảnh sản phẩm</th>
          <th scope="col">Hành động</th>
        </tr>
      </thead>
      <tbody id="productTableBody">
        <tr>
          <th scope="row"></th>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              type="button"
              class="btn btn-primary"
              style="background-color: red"
            >
              Xóa
            </button>
          </td>
        </tr>
        <tr>
          <th scope="row"></th>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              type="button"
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#viewproduct"
            >
              Xem
            </button>
            <button
              type="button"
              class="btn btn-primary"
              style="background-color: red"
            >
              Xóa
            </button>
          </td>
        </tr>
        <tr>
          <th scope="row"></th>
          <td colspan="1"></td>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
          <td>
            <button
              type="button"
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#viewproduct"
            >
              Xem
            </button>
            <button
              type="button"
              class="btn btn-primary"
              style="background-color: rgb(190, 190, 38)"
            >
              Chỉnh sửa
            </button>
            <button
              type="button"
              class="btn btn-primary"
              style="background-color: red"
            >
              Xóa
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <table class="table">
  <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Tên người dùng</th>
      <th scope="col">Mật khẩu</th>
      <th scope="col">Ảnh đại diện</th>
      <th scope="col">Vai trò</th>
      <th scope="col">Hành động</th>
    </tr>
  </thead>
  <tbody id="userTable"></tbody>
</table>

    <div
      class="modal fade"
      id="viewproduct"
      tabindex="-1"
      aria-labelledby="createProductModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="createProductModalLabel">
              Xem chi tiết
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
            <div class="modal-body">
              <form>
                <div class="mb-3">
                  <p></p>
                </div>
                <div class="mb-3">
                  <p></p>
                </div>
                <div class="mb-3">
                  <p></p>
                </div>
                <div class="mb-3">
                  <p></p>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>&copy; 2025 LapNest. All rights reserved.</p>
      <p><a href="mailto:contact@lamcamcomputer.com">contact@lapnest.com</a></p>
    </footer>

    <style>
      .navbar {
        background-color: #333 !important;
      }

      .navbar a {
        color: white !important;
      }

      footer {
        text-align: center;
        padding: 50px;
        width: 100%;
        background-color: #333;
        color: white;
      }
      body {
        text-align: center;
        font-family: Nunito;
      }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyChEl49-r3HUTq9Bff7DJt4jVyn1t1_AYQ",
        authDomain: "egdgdfg-fa829.firebaseapp.com",
        databaseURL: "https://egdgdfg-fa829-default-rtdb.firebaseio.com",
        projectId: "egdgdfg-fa829",
        storageBucket: "egdgdfg-fa829.firebasestorage.app",
        messagingSenderId: "782783477869",
        appId: "1:782783477869:web:0a9957ff8034c870b5a764",
        measurementId: "G-Y8DK2TV2QF",
      };

      // Initialize Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.database();

      document.getElementById("createProduct").addEventListener("click", function () {
  const productName = document.getElementById("productName").value.trim();
  const detail = document.getElementById("detail").value.trim();
  const price = document.getElementById("price").value.trim();
  const productUrl = document.getElementById("productUrl").value.trim();

  function isProductTaken(productName) {
    return db
      .ref("products")
      .orderByChild("productName")
      .equalTo(productName)
      .once("value")
      .then((snapshot) => {
        return snapshot.exists();
      });
  }

  isProductTaken(productName).then((taken) => {
    if (taken) {
      alert("Tên sản phẩm đã tồn tại!");
    } else {
      const newProductRef = db.ref("products").push();
      newProductRef
        .set({
          productName: productName,
          detail: detail,
          price: price,
          productUrl: productUrl,
        })
        .then(() => {
          alert("Sản phẩm đã được lưu thành công!");
          // Reset form nếu muốn:
          document.getElementById("productName").value = "";
          document.getElementById("detail").value = "";
          document.getElementById("price").value = "";
          document.getElementById("productUrl").value = "";
        })
        .catch((error) => {
          console.error("Lỗi khi lưu sản phẩm:", error);
        });
    }
  });

  
});


    </script>

<script>
  function loadProducts() {
    const productTableBody = document.getElementById("productTableBody");
    productTableBody.innerHTML = ""; // Xóa các dòng trống mẫu cũ

    db.ref("products").once("value", (snapshot) => {
      let index = 1;
      snapshot.forEach((childSnapshot) => {
        const product = childSnapshot.val();
        const key = childSnapshot.key;

        const row = document.createElement("tr");

        row.innerHTML = `
          <th scope="row">${index++}</th>
          <td>${product.productName || ""}</td>
          <td>${product.detail || ""}</td>
          <td>${product.price || ""}</td>
          <td><img src="${product.productUrl || ""}" width="100" height="auto"/></td>
          <td>
            <button
              type="button"
              class="btn btn-danger"
              onclick="deleteProduct('${key}')"
            >
              Xóa
            </button>
          </td>
        `;

        productTableBody.appendChild(row);
      });
    });
  }

  // Tải dữ liệu khi trang load
  window.addEventListener("load", loadProducts);

  // Xóa sản phẩm
  function deleteProduct(key) {
    if (confirm("Bạn có chắc chắn muốn xóa sản phẩm này?")) {
      db.ref("products/" + key).remove().then(() => {
        alert("Đã xóa sản phẩm.");
        loadProducts(); // Cập nhật bảng
      });
    }
  }


</script>

<script>
 function loadUsers() {
  const table = document.querySelector(".table");
  const userTableBody = document.getElementById("userTable");
  userTableBody.innerHTML = ""; // Xóa dòng cũ

  db.ref("users").once("value", (snapshot) => {
    let index = 1;
    snapshot.forEach((childSnapshot) => {
      const user = childSnapshot.val();
      const key = childSnapshot.key;

      const row = document.createElement("tr");

      row.innerHTML = `
        <th scope="row">${index++}</th>
        <td>${user.username || ""}</td>
        <td>${user.password || ""}</td>
        <td>
          <img src="${user.avatar || ""}" width="60" height="60" style="object-fit: cover; border-radius: 50%;" />
        </td>
        <td>${user.role || ""}</td>
        <td>
          <button
            type="button"
            class="btn btn-danger"
            onclick="deleteUser('${key}')"
          >
            Xóa
          </button>
        </td>
      `;

      userTableBody.appendChild(row);
    });
  });
}

function deleteUser(key) {
  if (confirm("Bạn có chắc chắn muốn xóa người dùng này không?")) {
    db.ref("users/" + key).remove().then(() => {
      alert("Đã xóa người dùng.");
      loadUsers();
    });
  }
}

// Gọi khi trang load
window.addEventListener("load", loadUsers);

</script>

<script>
  document.getElementById("createUser").addEventListener("click", function () {
    const username = document.querySelector("#createProductModal2 input[placeholder='Nhập tên người dùng']").value.trim();
    const password = document.querySelector("#createProductModal2 input[placeholder='Nhập mật khẩu']").value.trim();
    const avatar = document.getElementById("avatarUrl").value.trim();

    if (!username || !password) {
      alert("Vui lòng nhập đầy đủ tên người dùng và mật khẩu.");
      return;
    }

    function isUsernameTaken(username) {
      return db
        .ref("users")
        .orderByChild("username")
        .equalTo(username)
        .once("value")
        .then((snapshot) => snapshot.exists());
    }

    isUsernameTaken(username).then((taken) => {
      if (taken) {
        alert("Tên người dùng đã tồn tại!");
      } else {
        const newUserRef = db.ref("users").push();
        newUserRef
          .set({
            username: username,
            password: password,
            avatar: avatar
          })
          .then(() => {
            alert("Người dùng đã được tạo thành công!");
            // Reset form
            document.querySelector("#createProductModal2 input[placeholder='Nhập tên người dùng']").value = "";
            document.querySelector("#createProductModal2 input[placeholder='Nhập mật khẩu']").value = "";
            document.getElementById("avatarUrl").value = "";
            loadUsers(); // cập nhật bảng người dùng
          })
          .catch((error) => {
            console.error("Lỗi khi tạo người dùng:", error);
          });
      }
    });
  });
</script>




  </body>
</html>
